from __future__ import annotations
from QR_Code.utils.Classes import EncodingMode, ECCode

CHARACTER_CAPACITIES_BY_EC: dict[EncodingMode, dict[ECCode, list[int]]] = {
    EncodingMode.NUMERIC: {
        ECCode.L: [41, 77, 127, 187, 255, 322, 370, 461, 552, 652, 772, 883, 1022, 1101, 1250, 1408, 1548, 1725, 1903, 2061, 2232,
                   2409, 2620, 2812, 3057, 3283, 3517, 3669, 3909, 4158, 4417, 4686, 4965, 5235, 5529, 5836, 6153, 6479, 6743, 7089],

        ECCode.M: [34, 63, 101, 149, 202, 255, 293, 365, 432, 513, 604, 691, 796, 871, 991, 1082, 1212, 1346, 1500, 1600, 1708,
                   1872, 2059, 2188, 2395, 2544, 2701, 2857, 3035, 3289, 3486, 3693, 3909, 4134, 4343, 4588, 4775, 5039, 5313, 5596],

        ECCode.Q: [27, 48, 77, 111, 144, 178, 207, 259, 312, 364, 427, 489, 580, 621, 703, 775, 876, 948, 1063, 1159, 1224, 1358,
                   1468, 1588, 1718, 1804, 1933, 2085, 2181, 2358, 2473, 2670, 2805, 2949, 3081, 3244, 3417, 3599, 3791, 3993],

        ECCode.H: [17, 34, 58, 82, 106, 139, 154, 202, 235, 288, 331, 374, 427, 468, 530, 602, 674, 746, 813, 919, 969, 1056, 1108,
                   1228, 1286, 1425, 1501, 1581, 1677, 1782, 1897, 2022, 2157, 2301, 2361, 2524, 2625, 2735, 2927, 3057]
    },

    EncodingMode.ALPHA_NUMERIC: {
        ECCode.L: [25, 47, 77, 114, 154, 195, 224, 279, 335, 395, 468, 535, 619, 667, 758, 854, 938, 1046, 1153, 1249, 1352, 1460,
                   1588, 1704, 1853, 1990, 2132, 2223, 2369, 2520, 2677, 2840, 3009, 3183, 3351, 3537, 3729, 3927, 4087, 4296],

        ECCode.M: [20, 38, 61, 90, 122, 154, 178, 221, 262, 311, 366, 419, 483, 528, 600, 656, 734, 816, 909, 970, 1035, 1134, 1248,
                   1326, 1451, 1542, 1637, 1732, 1839, 1994, 2113, 2238, 2369, 2506, 2632, 2780, 2894, 3054, 3220, 3391],

        ECCode.Q: [16, 29, 47, 67, 87, 108, 125, 157, 189, 221, 259, 296, 352, 376, 426, 470, 531, 574, 644, 702, 742, 823, 890,
                   963, 1041, 1094, 1172, 1263, 1322, 1429, 1499, 1618, 1700, 1787, 1867, 1966, 2071, 2181, 2298, 2420],

        ECCode.H: [10, 20, 35, 50, 64, 84, 93, 122, 143, 174, 200, 227, 259, 283, 321, 365, 408, 452, 493, 557, 587, 640, 672, 744,
                   779, 864, 910, 958, 1016, 1080, 1150, 1226, 1307, 1394, 1431, 1530, 1591, 1658, 1774, 1852]
    },

    EncodingMode.BYTE: {
        ECCode.L: [17, 32, 53, 78, 106, 134, 154, 192, 230, 271, 321, 367, 425, 458, 520, 586, 644, 718, 792, 858, 929, 1003, 1091,
                   1171, 1273, 1367, 1465, 1528, 1628, 1732, 1840, 1952, 2068, 2188, 2303, 2431, 2563, 2699, 2809, 2953],

        ECCode.M: [14, 26, 42, 62, 84, 106, 122, 152, 180, 213, 251, 287, 331, 362, 412, 450, 504, 560, 624, 666, 711, 779, 857, 911,
                   997, 1059, 1125, 1190, 1264, 1370, 1452, 1538, 1628, 1722, 1809, 1911, 1989, 2099, 2213, 2331],

        ECCode.Q: [11, 20, 32, 46, 60, 74, 86, 108, 130, 151, 177, 203, 241, 258, 292, 322, 364, 394, 442, 482, 509, 565, 611, 661,
                   715, 751, 805, 868, 908, 982, 1030, 1112, 1168, 1228, 1283, 1351, 1423, 1499, 1579, 1663],

        ECCode.H: [7, 14, 24, 34, 44, 58, 64, 84, 98, 119, 137, 155, 177, 194, 220, 250, 280, 310, 338, 382, 403, 439, 461, 511, 535,
                   593, 625, 658, 698, 742, 790, 842, 898, 958, 983, 1051, 1093, 1139, 1219, 1273]
    },

    EncodingMode.KANJI: {
        ECCode.L: [10, 20, 32, 48, 65, 82, 95, 118, 141, 167, 198, 226, 262, 282, 320, 361, 397, 442, 488, 528, 572, 618, 672, 721,
                   784, 842, 902, 940, 1002, 1066, 1132, 1201, 1273, 1347, 1417, 1496, 1577, 1661, 1729, 1817],

        ECCode.M: [8, 16, 26, 38, 52, 65, 75, 93, 111, 131, 155, 177, 204, 223, 254, 277, 310, 345, 384, 410, 438, 480, 528, 561,
                   614, 652, 692, 732, 778, 843, 894, 947, 1002, 1060, 1113, 1176, 1224, 1292, 1362, 1435],

        ECCode.Q: [7, 12, 20, 28, 37, 45, 53, 66, 80, 93, 109, 125, 149, 159, 180, 198, 224, 243, 272, 297, 314, 348, 376, 407, 440,
                   462, 496, 534, 559, 604, 634, 684, 719, 756, 790, 832, 876, 923, 972, 1024],

        ECCode.H: [4, 8, 15, 21, 27, 36, 39, 52, 60, 74, 85, 96, 109, 120, 136, 154, 173, 191, 208, 235, 248, 270, 284, 315, 330, 365,
                   385, 405, 430, 457, 486, 518, 553, 590, 605, 647, 673, 701, 750, 784]
    }
}
CHARACTER_CAPACITIES_BY_VERSION: dict[EncodingMode, dict[int, list[int]]] = {
    EncodingMode.NUMERIC: {
        1: [41, 34, 27, 17],
        2: [77, 63, 48, 34],
        3: [127, 101, 77, 58],
        4: [187, 149, 111, 82],
        5: [255, 202, 144, 106],
        6: [322, 255, 178, 139],
        7: [370, 293, 207, 154],
        8: [461, 365, 259, 202],
        9: [552, 432, 312, 235],
        10: [652, 513, 364, 288],
        11: [772, 604, 427, 331],
        12: [883, 691, 489, 374],
        13: [1022, 796, 580, 427],
        14: [1101, 871, 621, 468],
        15: [1250, 991, 703, 530],
        16: [1408, 1082, 775, 602],
        17: [1548, 1212, 876, 674],
        18: [1725, 1346, 948, 746],
        19: [1903, 1500, 1063, 813],
        20: [2061, 1600, 1159, 919],
        21: [2232, 1708, 1224, 969],
        22: [2409, 1872, 1358, 1056],
        23: [2620, 2059, 1468, 1108],
        24: [2812, 2188, 1588, 1228],
        25: [3057, 2395, 1718, 1286],
        26: [3283, 2544, 1804, 1425],
        27: [3517, 2701, 1933, 1501],
        28: [3669, 2857, 2085, 1581],
        29: [3909, 3035, 2181, 1677],
        30: [4158, 3289, 2358, 1782],
        31: [4417, 3486, 2473, 1897],
        32: [4686, 3693, 2670, 2022],
        33: [4965, 3909, 2805, 2157],
        34: [5253, 4134, 2949, 2301],
        35: [5529, 4343, 3081, 2361],
        36: [5836, 4588, 3244, 2524],
        37: [6153, 4775, 3417, 2625],
        38: [6479, 5039, 3599, 2735],
        39: [6743, 5313, 3791, 2927],
        40: [7089, 5596, 3993, 3057]
    },

    EncodingMode.ALPHA_NUMERIC: {
        1: [25, 20, 16, 10],
        2: [47, 38, 29, 20],
        3: [77, 61, 47, 35],
        4: [114, 90, 67, 50],
        5: [154, 122, 87, 64],
        6: [195, 154, 108, 84],
        7: [224, 178, 125, 93],
        8: [279, 221, 157, 122],
        9: [335, 262, 189, 143],
        10: [395, 311, 221, 174],
        11: [468, 366, 259, 200],
        12: [535, 419, 296, 227],
        13: [619, 483, 352, 259],
        14: [667, 528, 376, 283],
        15: [758, 600, 426, 321],
        16: [854, 656, 470, 365],
        17: [938, 734, 531, 408],
        18: [1046, 816, 574, 452],
        19: [1153, 909, 644, 493],
        20: [1249, 970, 702, 557],
        21: [1352, 1035, 742, 587],
        22: [1460, 1134, 823, 640],
        23: [1588, 1248, 890, 672],
        24: [1704, 1326, 963, 744],
        25: [1853, 1451, 1041, 779],
        26: [1990, 1542, 1094, 864],
        27: [2132, 1637, 1172, 910],
        28: [2223, 1732, 1263, 958],
        29: [2369, 1839, 1322, 1016],
        30: [2520, 1994, 1429, 1080],
        31: [2677, 2113, 1499, 1150],
        32: [2840, 2238, 1618, 1226],
        33: [3009, 2369, 1700, 1307],
        34: [3183, 2506, 1787, 1394],
        35: [3351, 2632, 1867, 1431],
        36: [3537, 2780, 1966, 1530],
        37: [3729, 2894, 2071, 1591],
        38: [3927, 3054, 2181, 1658],
        39: [4087, 3220, 2298, 1774],
        40: [4296, 3391, 2420, 1852]
    },

    EncodingMode.BYTE: {
        1: [17, 14, 11, 7],
        2: [32, 26, 20, 14],
        3: [53, 42, 32, 24],
        4: [78, 62, 46, 34],
        5: [106, 84, 60, 44],
        6: [134, 106, 74, 58],
        7: [154, 122, 86, 64],
        8: [192, 152, 108, 84],
        9: [230, 180, 130, 98],
        10: [271, 213, 151, 119],
        11: [321, 251, 177, 137],
        12: [367, 287, 203, 155],
        13: [425, 331, 241, 177],
        14: [458, 362, 258, 194],
        15: [520, 412, 292, 220],
        16: [586, 450, 322, 250],
        17: [644, 504, 364, 280],
        18: [718, 560, 394, 310],
        19: [792, 624, 442, 338],
        20: [858, 666, 482, 382],
        21: [929, 711, 509, 403],
        22: [1003, 779, 565, 439],
        23: [1091, 857, 611, 461],
        24: [1171, 911, 661, 511],
        25: [1273, 997, 715, 535],
        26: [1367, 1059, 751, 593],
        27: [1465, 1125, 805, 625],
        28: [1528, 1190, 868, 658],
        29: [1628, 1264, 908, 698],
        30: [1732, 1370, 982, 742],
        31: [1840, 1452, 1030, 790],
        32: [1952, 1538, 1112, 842],
        33: [2068, 1628, 1168, 898],
        34: [2188, 1722, 1228, 958],
        35: [2303, 1809, 1283, 983],
        36: [2431, 1911, 1351, 1051],
        37: [2563, 1989, 1423, 1093],
        38: [2699, 2099, 1499, 1139],
        39: [2809, 2213, 1579, 1219],
        40: [2953, 2331, 1663, 1273]
    },

    EncodingMode.KANJI: {
        1: [10, 8, 7, 4],
        2: [20, 16, 12, 8],
        3: [32, 26, 20, 15],
        4: [48, 38, 28, 21],
        5: [65, 52, 37, 27],
        6: [82, 65, 45, 36],
        7: [95, 75, 53, 39],
        8: [118, 93, 66, 52],
        9: [141, 111, 80, 60],
        10: [167, 131, 93, 74],
        11: [198, 155, 109, 85],
        12: [226, 177, 125, 96],
        13: [262, 204, 149, 109],
        14: [282, 223, 159, 120],
        15: [320, 254, 180, 136],
        16: [361, 277, 198, 154],
        17: [397, 310, 224, 173],
        18: [442, 345, 243, 191],
        19: [488, 384, 272, 208],
        20: [528, 410, 297, 235],
        21: [572, 438, 314, 248],
        22: [618, 480, 348, 270],
        23: [672, 528, 376, 284],
        24: [721, 561, 407, 315],
        25: [784, 614, 440, 330],
        26: [842, 652, 462, 365],
        27: [902, 692, 496, 385],
        28: [940, 732, 534, 405],
        29: [1002, 778, 559, 430],
        30: [1066, 843, 604, 457],
        31: [1132, 894, 634, 486],
        32: [1201, 947, 684, 518],
        33: [1273, 1002, 719, 553],
        34: [1347, 1060, 756, 590],
        35: [1417, 1113, 790, 605],
        36: [1496, 1176, 832, 647],
        37: [1577, 1224, 876, 673],
        38: [1661, 1292, 923, 701],
        39: [1729, 1362, 972, 750],
        40: [1817, 1435, 1024, 784]
    }
}

EC_CODE_IDX = {
    0: ECCode.L,
    1: ECCode.M,
    2: ECCode.Q,
    3: ECCode.H
}

# key: version + error_correction
# value:
#   index 0: Total Number of Data Codewords for this Version and EC Level
#   index 1: EC Codewords Per Block
#   index 2: Number of Blocks in Group 1
#   index 3: Number of Data Codewords in Each of Group 1's Blocks
#   index 4: Number of Blocks in Group 2
#   index 5: Number of Data Codewords in Each of Group 2's Blocks


CODEWORDS_AND_BLOCK_INFO = {
    '1L': (19, 7, 1, 19, 0, 0),
    '1M': (16, 10, 1, 16, 0, 0),
    '1Q': (13, 13, 1, 13, 0, 0),
    '1H': (9, 17, 1, 9, 0, 0),
    '2L': (34, 10, 1, 34, 0, 0),
    '2M': (28, 16, 1, 28, 0, 0),
    '2Q': (22, 22, 1, 22, 0, 0),
    '2H': (16, 28, 1, 16, 0, 0),
    '3L': (55, 15, 1, 55, 0, 0),
    '3M': (44, 26, 1, 44, 0, 0),
    '3Q': (34, 18, 2, 17, 0, 0),
    '3H': (26, 22, 2, 13, 0, 0),
    '4L': (80, 20, 1, 80, 0, 0),
    '4M': (64, 18, 2, 32, 0, 0),
    '4Q': (48, 26, 2, 24, 0, 0),
    '4H': (36, 16, 4, 9, 0, 0),
    '5L': (108, 26, 1, 108, 0, 0),
    '5M': (86, 24, 2, 43, 0, 0),
    '5Q': (62, 18, 2, 15, 2, 16),
    '5H': (46, 22, 2, 11, 2, 12),
    '6L': (136, 18, 2, 68, 0, 0),
    '6M': (108, 16, 4, 27, 0, 0),
    '6Q': (76, 24, 4, 19, 0, 0),
    '6H': (60, 28, 4, 15, 0, 0),
    '7L': (156, 20, 2, 78, 0, 0),
    '7M': (124, 18, 4, 31, 0, 0),
    '7Q': (88, 18, 2, 14, 4, 15),
    '7H': (66, 26, 4, 13, 1, 14),
    '8L': (194, 24, 2, 97, 0, 0),
    '8M': (154, 22, 2, 38, 2, 39),
    '8Q': (110, 22, 4, 18, 2, 19),
    '8H': (86, 26, 4, 14, 2, 15),
    '9L': (232, 30, 2, 116, 0, 0),
    '9M': (182, 22, 3, 36, 2, 37),
    '9Q': (132, 20, 4, 16, 4, 17),
    '9H': (100, 24, 4, 12, 4, 13),
    '10L': (274, 18, 2, 68, 2, 69),
    '10M': (216, 26, 4, 43, 1, 44),
    '10Q': (154, 24, 6, 19, 2, 20),
    '10H': (122, 28, 6, 15, 2, 16),
    '11L': (324, 20, 4, 81, 0, 0),
    '11M': (254, 30, 1, 50, 4, 51),
    '11Q': (180, 28, 4, 22, 4, 23),
    '11H': (140, 24, 3, 12, 8, 13),
    '12L': (370, 24, 2, 92, 2, 93),
    '12M': (290, 22, 6, 36, 2, 37),
    '12Q': (206, 26, 4, 20, 6, 21),
    '12H': (158, 28, 7, 14, 4, 15),
    '13L': (428, 26, 4, 107, 0, 0),
    '13M': (334, 22, 8, 37, 1, 38),
    '13Q': (244, 24, 8, 20, 4, 21),
    '13H': (180, 22, 12, 11, 4, 12),
    '14L': (461, 30, 3, 115, 1, 116),
    '14M': (365, 24, 4, 40, 5, 41),
    '14Q': (261, 20, 11, 16, 5, 17),
    '14H': (197, 24, 11, 12, 5, 13),
    '15L': (523, 22, 5, 87, 1, 88),
    '15M': (415, 24, 5, 41, 5, 42),
    '15Q': (295, 30, 5, 24, 7, 25),
    '15H': (223, 24, 11, 12, 7, 13),
    '16L': (589, 24, 5, 98, 1, 99),
    '16M': (453, 28, 7, 45, 3, 46),
    '16Q': (325, 24, 15, 19, 2, 20),
    '16H': (253, 30, 3, 15, 13, 16),
    '17L': (647, 28, 1, 107, 5, 108),
    '17M': (507, 28, 10, 46, 1, 47),
    '17Q': (367, 28, 1, 22, 15, 23),
    '17H': (283, 28, 2, 14, 17, 15),
    '18L': (721, 30, 5, 120, 1, 121),
    '18M': (563, 26, 9, 43, 4, 44),
    '18Q': (397, 28, 17, 22, 1, 23),
    '18H': (313, 28, 2, 14, 19, 15),
    '19L': (795, 28, 3, 113, 4, 114),
    '19M': (627, 26, 3, 44, 11, 45),
    '19Q': (445, 26, 17, 21, 4, 22),
    '19H': (341, 26, 9, 13, 16, 14),
    '20L': (861, 28, 3, 107, 5, 108),
    '20M': (669, 26, 3, 41, 13, 42),
    '20Q': (485, 30, 15, 24, 5, 25),
    '20H': (385, 28, 15, 15, 10, 16),
    '21L': (932, 28, 4, 116, 4, 117),
    '21M': (714, 26, 17, 42, 0, 0),
    '21Q': (512, 28, 17, 22, 6, 23),
    '21H': (406, 30, 19, 16, 6, 17),
    '22L': (1006, 28, 2, 111, 7, 112),
    '22M': (782, 28, 17, 46, 0, 0),
    '22Q': (568, 30, 7, 24, 16, 25),
    '22H': (442, 24, 34, 13, 0, 0),
    '23L': (1094, 30, 4, 121, 5, 122),
    '23M': (860, 28, 4, 47, 14, 48),
    '23Q': (614, 30, 11, 24, 14, 25),
    '23H': (464, 30, 16, 15, 14, 16),
    '24L': (1174, 30, 6, 117, 4, 118),
    '24M': (914, 28, 6, 45, 14, 46),
    '24Q': (664, 30, 11, 24, 16, 25),
    '24H': (514, 30, 30, 16, 2, 17),
    '25L': (1276, 26, 8, 106, 4, 107),
    '25M': (1000, 28, 8, 47, 13, 48),
    '25Q': (718, 30, 7, 24, 22, 25),
    '25H': (538, 30, 22, 15, 13, 16),
    '26L': (1370, 28, 10, 114, 2, 115),
    '26M': (1062, 28, 19, 46, 4, 47),
    '26Q': (754, 28, 28, 22, 6, 23),
    '26H': (596, 30, 33, 16, 4, 17),
    '27L': (1468, 30, 8, 122, 4, 123),
    '27M': (1128, 28, 22, 45, 3, 46),
    '27Q': (808, 30, 8, 23, 26, 24),
    '27H': (628, 30, 12, 15, 28, 16),
    '28L': (1531, 30, 3, 117, 10, 118),
    '28M': (1193, 28, 3, 45, 23, 46),
    '28Q': (871, 30, 4, 24, 31, 25),
    '28H': (661, 30, 11, 15, 31, 16),
    '29L': (1631, 30, 7, 116, 7, 117),
    '29M': (1267, 28, 21, 45, 7, 46),
    '29Q': (911, 30, 1, 23, 37, 24),
    '29H': (701, 30, 19, 15, 26, 16),
    '30L': (1735, 30, 5, 115, 10, 116),
    '30M': (1373, 28, 19, 47, 10, 48),
    '30Q': (985, 30, 15, 24, 25, 25),
    '30H': (745, 30, 23, 15, 25, 16),
    '31L': (1843, 30, 13, 115, 3, 116),
    '31M': (1455, 28, 2, 46, 29, 47),
    '31Q': (1033, 30, 42, 24, 1, 25),
    '31H': (793, 30, 23, 15, 28, 16),
    '32L': (1955, 30, 17, 115, 0, 0),
    '32M': (1541, 28, 10, 46, 23, 47),
    '32Q': (1115, 30, 10, 24, 35, 25),
    '32H': (845, 30, 19, 15, 35, 16),
    '33L': (2071, 30, 17, 115, 1, 116),
    '33M': (1631, 28, 14, 46, 21, 47),
    '33Q': (1171, 30, 29, 24, 19, 25),
    '33H': (901, 30, 11, 15, 46, 16),
    '34L': (2191, 30, 13, 115, 6, 116),
    '34M': (1725, 28, 14, 46, 23, 47),
    '34Q': (1231, 30, 44, 24, 7, 25),
    '34H': (961, 30, 59, 16, 1, 17),
    '35L': (2306, 30, 12, 121, 7, 122),
    '35M': (1812, 28, 12, 47, 26, 48),
    '35Q': (1286, 30, 39, 24, 14, 25),
    '35H': (986, 30, 22, 15, 41, 16),
    '36L': (2434, 30, 6, 121, 14, 122),
    '36M': (1914, 28, 6, 47, 34, 48),
    '36Q': (1354, 30, 46, 24, 10, 25),
    '36H': (1054, 30, 2, 15, 64, 16),
    '37L': (2566, 30, 17, 122, 4, 123),
    '37M': (1992, 28, 29, 46, 14, 47),
    '37Q': (1426, 30, 49, 24, 10, 25),
    '37H': (1096, 30, 24, 15, 46, 16),
    '38L': (2702, 30, 4, 122, 18, 123),
    '38M': (2102, 28, 13, 46, 32, 47),
    '38Q': (1502, 30, 48, 24, 14, 25),
    '38H': (1142, 30, 42, 15, 32, 16),
    '39L': (2812, 30, 20, 117, 4, 118),
    '39M': (2216, 28, 40, 47, 7, 48),
    '39Q': (1582, 30, 43, 24, 22, 25),
    '39H': (1222, 30, 10, 15, 67, 16),
    '40L': (2956, 30, 19, 118, 6, 119),
    '40M': (2334, 28, 18, 47, 31, 48),
    '40Q': (1666, 30, 34, 24, 34, 25),
    '40H': (1276, 30, 20, 15, 61, 16)
}
